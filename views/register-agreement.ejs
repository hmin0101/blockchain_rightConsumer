<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Register</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>

    <!--  Bootstrap 4.3.1  -->
    <link rel="stylesheet" href="/stylesheets/bootstrap-4.3.1.min.css">
    <!--  Font Awesome -->
    <link rel="stylesheet" href="/stylesheets/font-awesome/css/font-awesome.css">
    <!--  Awesome Bootstrap Checkbox  -->
    <link rel="stylesheet" href="/stylesheets/awesome-bootstrap-checkbox.css">
    <!--  Custom CSS  -->
    <link rel='stylesheet' href='/stylesheets/style.css' />

    <style>
      .register-logo {
        font-size: 69px;
        font-weight: 300;
        letter-spacing: -5px;
      }

      .form-agreement {
        max-height: 200px;
        padding: 12px 20px;
        background-color: #f2f9fa;
        border: 1px solid #e7eaec;
        border-radius: 5px;
        font-size: 13px;
        overflow-y: auto;
      }
      .form-agreement::-webkit-scrollbar {
        width: 6px;
      }
      .form-agreement::-webkit-scrollbar-track {
        background: #f1f3f1;
      }
      .form-agreement::-webkit-scrollbar-thumb {
        background: #34558B;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <section>
      <div class="container">
        <div class="row align-items-center justify-content-center min-vh-100">
          <div class="col-lg-8 py-5">
            <div class="text-center">
              <h3 class="register-logo mb-2 main-color-6-f">Register</h3>
              <p class="mb-5 main-color-3-f">Sign in to your account to continue.</p>
            </div>
            <div class="form-group">
              <div class="form-group">
                <div class="form-check abc-checkbox abc-checkbox-primary">
                  <input class="form-check-input" id="check-agreement-1" type="checkbox">
                  <label class="form-check-label" for="check-agreement-1">Agreement 1</label>
                </div>
                <div class="form-agreement">
                  주식회사 카카오(이하 ‘회사’)가 제공하는 서비스를 이용해 주셔서 감사합니다. 회사는 여러분이 회사가 제공하는 다양한 인터넷과 모바일 서비스(카카오 서비스, Daum 서비스, 멜론 서비스 등을 의미하며 이하 해당 서비스들을 모두 합하여 “통합서비스” 또는 “서비스”라 함)에 더 가깝고 편리하게 다가갈 수 있도록 ‘카카오 통합서비스약관’(이하 ‘본 약관’)을 마련하였습니다. 여러분은 본 약관에 동의함으로써 통합서비스에 가입하여 통합서비스를 이용할 수 있습니다. 단, 여러분은 회사가 아닌 계열사를 포함한 제3자가 제공하는 서비스 (예: ㈜카카오모빌리티가 제공하는 카카오 T 택시 서비스)에 가입되지는 않으며, 회사가 제공하는 유료서비스 (예: 멜론 유료서비스)의 경우 여러분이 별도의 유료이용약관에 대한 동의한 때에 회사와 여러분 간의 유료서비스 이용계약이 성립합니다. 본 약관은 여러분이 통합서비스를 이용하는 데 필요한 권리, 의무 및 책임사항, 이용조건 및 절차 등 기본적인 사항을 규정하고 있으므로 조금만 시간을 내서 주의 깊게 읽어주시기 바랍니다.
                </div>
              </div>
              <div class="form-group">
                <div class="form-check abc-checkbox abc-checkbox-primary">
                  <input class="form-check-input" id="check-agreement-2" type="checkbox">
                  <label class="form-check-label" for="check-agreement-2">Agreement 2</label>
                </div>
                <div class="form-agreement">
                  주식회사 카카오(이하 ‘회사’)가 제공하는 서비스를 이용해 주셔서 감사합니다. 회사는 여러분이 회사가 제공하는 다양한 인터넷과 모바일 서비스(카카오 서비스, Daum 서비스, 멜론 서비스 등을 의미하며 이하 해당 서비스들을 모두 합하여 “통합서비스” 또는 “서비스”라 함)에 더 가깝고 편리하게 다가갈 수 있도록 ‘카카오 통합서비스약관’(이하 ‘본 약관’)을 마련하였습니다. 여러분은 본 약관에 동의함으로써 통합서비스에 가입하여 통합서비스를 이용할 수 있습니다. 단, 여러분은 회사가 아닌 계열사를 포함한 제3자가 제공하는 서비스 (예: ㈜카카오모빌리티가 제공하는 카카오 T 택시 서비스)에 가입되지는 않으며, 회사가 제공하는 유료서비스 (예: 멜론 유료서비스)의 경우 여러분이 별도의 유료이용약관에 대한 동의한 때에 회사와 여러분 간의 유료서비스 이용계약이 성립합니다. 본 약관은 여러분이 통합서비스를 이용하는 데 필요한 권리, 의무 및 책임사항, 이용조건 및 절차 등 기본적인 사항을 규정하고 있으므로 조금만 시간을 내서 주의 깊게 읽어주시기 바랍니다.
                </div>
              </div>
              <div class="form-group">
                <div class="form-check abc-checkbox abc-checkbox-primary">
                  <input class="form-check-input" id="check-agreement-3" type="checkbox">
                  <label class="form-check-label" for="check-agreement-3">Agreement 3</label>
                </div>
                <div class="form-agreement">
                  주식회사 카카오(이하 ‘회사’)가 제공하는 서비스를 이용해 주셔서 감사합니다. 회사는 여러분이 회사가 제공하는 다양한 인터넷과 모바일 서비스(카카오 서비스, Daum 서비스, 멜론 서비스 등을 의미하며 이하 해당 서비스들을 모두 합하여 “통합서비스” 또는 “서비스”라 함)에 더 가깝고 편리하게 다가갈 수 있도록 ‘카카오 통합서비스약관’(이하 ‘본 약관’)을 마련하였습니다. 여러분은 본 약관에 동의함으로써 통합서비스에 가입하여 통합서비스를 이용할 수 있습니다. 단, 여러분은 회사가 아닌 계열사를 포함한 제3자가 제공하는 서비스 (예: ㈜카카오모빌리티가 제공하는 카카오 T 택시 서비스)에 가입되지는 않으며, 회사가 제공하는 유료서비스 (예: 멜론 유료서비스)의 경우 여러분이 별도의 유료이용약관에 대한 동의한 때에 회사와 여러분 간의 유료서비스 이용계약이 성립합니다. 본 약관은 여러분이 통합서비스를 이용하는 데 필요한 권리, 의무 및 책임사항, 이용조건 및 절차 등 기본적인 사항을 규정하고 있으므로 조금만 시간을 내서 주의 깊게 읽어주시기 바랍니다.
                </div>
              </div>
            </div>
            <div class="row form-group">
              <div class="col-lg-6">
                <button class="btn btn-block btn-basic" data-toggle="modal" data-target="#modal-sign">Agreement Sign</button>
              </div>
              <div class="col-lg-6">
                <button class="btn btn-block btn-basic" id="btn-register">Register</button>
              </div>
            </div>
            <div class="text-center">
              <a class="btn-link" id="btn-signin" href="/login">sign in</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="hidden loading-cover">
      <span class="loading-message">Pair Key 생성 중입니다.</span>
      <div class="spiner-example">
        <div class="sk-spinner sk-spinner-fading-circle">
          <div class="sk-circle1 sk-circle"></div>
          <div class="sk-circle2 sk-circle"></div>
          <div class="sk-circle3 sk-circle"></div>
          <div class="sk-circle4 sk-circle"></div>
          <div class="sk-circle5 sk-circle"></div>
          <div class="sk-circle6 sk-circle"></div>
          <div class="sk-circle7 sk-circle"></div>
          <div class="sk-circle8 sk-circle"></div>
          <div class="sk-circle9 sk-circle"></div>
          <div class="sk-circle10 sk-circle"></div>
          <div class="sk-circle11 sk-circle"></div>
          <div class="sk-circle12 sk-circle"></div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modal-sign" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Agreement Sign</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="row modal-body">
            <div class="col-lg-6">
              <div class="row justify-content-center flex-wrap">
                <p class="mb-1 block text-center">Pair Key가 없는 경우</p>
                <button type="button" class="btn btn-sm btn-basic" id="btn-create-key">Create Key</button>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="row justify-content-center">
                <p class="mb-1 block text-center">Pair Key가 있는 경우</p>
                <button type="button" class="btn btn-sm btn-basic" id="btn-upload-key">Upload Key</button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-basic" id="btn-sign">Sign</button>
          </div>
        </div>
      </div>
    </div>

    <!--  JQuery  -->
    <script src="/javascripts/jquery-1.12.4.min.js"></script>
    <!--  Bootstrap 4.3.1 JS  -->
    <script src="/javascripts/bootstrap-4.3.1.min.js"></script>
    <!--  Subtle Crypto  -->
    <script src="/javascripts/subtleCrypto.js"></script>
    <script>
      $(document).ready(function() {
        const userName = '<%= userName %>';
        let signature = null;
        let publicKey = null;

        // Create pair key
        $('#btn-create-key').on('click', async function() {
          $('.loading-cover').removeClass("hidden");
          await generateKey();
          await exportPrivateKey();
          publicKey = await exportPublicKey();
          $('.loading-cover').addClass("hidden");
        });

        // Upload pair key
        $('#btn-upload-key').on('click', function() {

        });

        // Sign button event
        $('#btn-sign').on('click', async function() {
          console.log(userName);
          signature = await createSignature(userName);
          console.log(signature);
          $('#modal-sign').modal('hide');
        });

        // Next button event
        $('#btn-register').on('click', function() {
          if (signature !== null) {
            const data = {
              agreement: {
                "1": $('#check-agreement-1').is(':checked'),
                "2": $('#check-agreement-2').is(':checked'),
                "3": $('#check-agreement-3').is(':checked'),
              },
              signature: signature,
              publicKey: publicKey
            };

            $.ajax({
              type: "POST",
              url: "/register",
              data: "data="+JSON.stringify(data),
              success: function() {
                location.href = "/login";
              }
            });
          } else {
            alert("Private Key를 이용하여 동의에 대한 Sign을 해주세요.");
          }
        });
      });
    </script>
  </body>
</html>
